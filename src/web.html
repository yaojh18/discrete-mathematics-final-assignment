<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="e:/D3/d3.min.js"> </script>
</head>
<body>
    <script>  
        var marge = {
top:60,
right:60,
bottom:60,
left:60
}

var svg = d3.select('body').append('svg').attr('width',900).attr('height',600);
var width = svg.attr('width');
var height = svg.attr('height');

var g = svg.append('g').attr('transform','translate('+marge.left+','+marge.top+')');

var nodes = [
{name:'河北'},
{name:'河南'},
{name:'广东'},
{name:'广西'},
{name:'新疆'},
{name:'内蒙古'}
]

var edges = [
{source:0,target:1,relation:'喝酒',value:1.5},
{source:1,target:0,relation:'喝酒',value:1.5},
{source:1,target:2,relation:'唱歌',value:2},
{source:2,target:3,relation:'麻将',value:2},
{source:3,target:4,relation:'捉鱼',value:2},
{source:4,target:5,relation:'上山',value:2},
{source:5,target:1,relation:'打工',value:2},
{source:5,target:2,relation:'种花',value:3}
];

var colorScale = d3.scaleOrdinal().domain(d3.range(nodes.length)).range(d3.schemeCategory10);

// 新建力导向图
var forceSimulation = d3.forceSimulation()
.force('link',d3.forceLink())
.force('charge',d3.forceManyBody())
.force('center',d3.forceCenter());

// 生成节点
forceSimulation.nodes(nodes)
.on('tick',render);


// 生成边集
forceSimulation.force('link')
.links(edges)
.distance(function(d){
return d.value*100;
})


// 力导向图中心位置
forceSimulation.force('center')
.x(width/2)
.y(height/2);

console.log(nodes);
console.log(edges);

// 边
var links = g.append('g')
.selectAll('line')
.data(edges)
.enter()
.append('line')
.attr('stroke',function(d,i){
return colorScale(i);
})
.attr('stroke-width',1)

// 边上的文字
var linksText = g.append('g')
.selectAll('text')
.data(edges)
.enter()
.append('text')
.text(function(d,i){
return d.relation;
})

//节点
var gs = g.selectAll('.node')
.data(nodes)
.enter()
.append('g')
.call(
d3.drag()
.on('start',started)
.on('drag',dragged)
.on('end',ended)
)


gs.append('circle')
.attr('r',10)
.attr('fill',function(d,i){
return colorScale(i);
})

gs.append('text')
.text(function(d,i){
return d.name;
})
.attr('width',100)
.attr('height',30)
.attr('text-anchor','middle')
.attr('x',0)
.attr('y',-30)
.attr('fill',function(d,i){
return colorScale(i);
})





function started(d){
if(!d3.event.active){
forceSimulation.alphaTarget(0.8).restart();
}

d.fx = d.x;
d.fy = d.y;
}

function dragged(d){
d.fx = d3.event.x;
d.fy = d3.event.y;
}

function ended(d){
if(!d3.event.active){
forceSimulation.alphaTarget(0);
}
d.fx = null;
d.fy = null;
}

function render(){
// 线的位置
links.attr('x1',function(d){
return d.source.x;
})

links.attr('y1',function(d){
return d.source.y;
})

links.attr('x2',function(d){
return d.target.x;
})

links.attr('y2',function(d){
return d.target.y;
})

// 线上的文字的位置
linksText.attr('x',function(d){
return (d.source.x+d.target.x)/2;
})

linksText.attr('y',function(d){
return (d.source.y + d.target.y)/2;
})

//圆点的位置
gs.attr('transform',function(d,i){
return 'translate('+d.x+','+d.y+')';
})
}
    </script> 
</body>
</html>